# where-to-eat 技能介绍

**多人聚餐地点与餐厅推荐** —— 基于参与者位置与偏好，自动计算最优见面点并推荐周边餐厅。

---

## 前置依赖（使用前请准备）

- **高德地图开放平台 Key**：技能通过高德 Web 服务 API 做地理编码、路线规划、POI 搜索。请先 [注册高德开放平台](https://lbs.amap.com/) 并创建应用、获取 Key，并开通：Web 服务、地理/逆地理编码、路径规划、POI 搜索等。
- **MCP 环境**：需在 Cursor / Claude 等环境中配置 **高德地图 MCP 服务**（如 `amap-maps`），使技能能调用 `mcp_amap-maps_*` 系列工具。Key 在 MCP 或环境配置中填写，**不要写入本仓库代码或文档**。

---

## 一句话介绍

当多人想一起吃饭时，本技能根据每个人的出发地（如地铁站、小区），计算**时间最公平**的中间地点，并基于美食偏好推荐周边 **TOP 5 餐厅**，支持驾车、地铁、公交等多种出行方式对比，并可导出为 Markdown 文档便于分享。

---

## 何时使用

在以下场景下可调用本技能：

- 用户说：「大家一起吃饭」「找个中间地点」「约饭」「聚餐地点」「怎么分配地点」「聚个餐」
- 或讨论：「多人聚餐」「最方便的地点」「几个人怎么约饭」「餐厅推荐」

**调用方式**：`mtskills read where-to-eat`（在 Claude / Cursor 等环境中按技能系统约定使用）。

---

## 核心能力

| 能力 | 说明 |
|------|------|
| **地理中心计算** | 根据多个出发地坐标计算重心，作为理想见面点基准 |
| **多方式出行时间** | 优先使用高德地图 API 获取驾车/地铁/公交的实时时间；区分纯运行时间与总出行时间（含步行、换乘） |
| **时间公平性** | 用方差衡量「大家花的时间是否接近」，方差越小越公平 |
| **多方案对比** | 同时给出驾车、地铁、公交等方案，说明优缺点，由用户选择 |
| **餐厅推荐** | 按评分与距离等综合排序，推荐 TOP 5，并控制 API 调用次数（餐厅详情 ≤25 次） |
| **Markdown 导出** | 可选生成并保存 `聚餐推荐_[日期]_[时间].md`，便于分享给参与者 |

---

## 设计原则

- **API 优先**：出行时间以高德地图 API 为准；仅在 API 不可用时才用估算，并明确标注「估算」。
- **利用用户知识**：主动询问用户是否知道更优路线，若用户提供且可验证，则优先采用。
- **时间上下文**：必须明确聚餐时间（如「晚上 7 点」），区分「现在出发」与「指定时间到达」，并考虑高峰时段与缓冲时间。
- **尊重偏好**：若用户明确「不要某种交通方式」（如不要电单车），则彻底排除，不在推荐中出现。

---

## 项目结构

```
where-to-eat/
├── README.md                 # 本介绍文档
├── SKILL.md                  # 技能主文档（流程、步骤、规则）
├── SKILL_OPTIMIZATION_GUIDE.md  # 优化说明与设计取舍
├── CHANGELOG.md              # 版本更新记录
├── references/               # 参考材料
│   ├── algorithm.md         # 地理与时间算法详解
│   ├── api-guide.md         # 高德 API 使用说明
│   └── examples.md          # 示例与话术
└── scripts/
    └── centroid_calculator.py   # 重心计算与出行时间解析（Python）
```

- **SKILL.md**：完整执行步骤、参数收集、数据校验、Markdown 输出等，是执行技能时的主依据。
- **references/**：算法原理、API 用法与示例，供实现与排查时查阅。
- **scripts/**：重心坐标计算、API 响应解析（如地铁/公交各段时间拆分）等可复用逻辑。

---

## 版本与迭代

- **当前版本**：v1.1.3  
- **主要迭代**（详见 `CHANGELOG.md`）：
  - v1.1.0：API 解析细化、用户路线知识、时间上下文、多方案对比与数据校验。
  - v1.1.1：API 不可用时的估算兜底与标注规范。
  - v1.1.2：明确「API 优先、估算仅作兜底」的原则。
  - v1.1.3：新增 Step 10「生成并保存 Markdown 文档」。

---

## 快速示例

**用户输入**：  
「我们三个人在来广营、霍营、朱辛庄，想一起吃烤肉，帮我们找聚餐地点和餐厅。」

**技能会**：  
1. 对来广营、霍营、朱辛庄做地理编码并取坐标。  
2. 计算中心，并可选询问用户是否已知更优路线。  
3. 调用高德 API 获取驾车/地铁/公交到该重心的时间，解析步行、换乘、纯运行时间。  
4. 校验时间合理性，对比多方案时间相似度。  
5. 推荐中间地点 + 各出行方案优缺点。  
6. 按聚餐时间推算出发时间（含高峰与缓冲）。  
7. 按「烤肉」偏好搜索周边餐厅，推荐 TOP 5。  
8. 可选生成并保存 `聚餐推荐_[日期]_[时间].md`。

---

## 相关文档

- 执行细节与步骤：**SKILL.md** 
- 算法与 API：**references/algorithm.md**、**references/api-guide.md**

---

## License

MIT License，详见 [LICENSE](LICENSE)。
